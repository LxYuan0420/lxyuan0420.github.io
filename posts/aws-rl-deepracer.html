<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lx | My first reinforcement learning model on AWS</title>
  <meta name="description" content="This article demonstrates my experience of training a reinforcement learning (RL) model on AWS.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="My first reinforcement learning model on AWS">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lxyuan0420.github.io/posts/aws-rl-deepracer">
  <meta property="og:description" content="This article demonstrates my experience of training a reinforcement learning (RL) model on AWS.">
  <meta property="og:site_name" content="Lx">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://lxyuan0420.github.io/posts/aws-rl-deepracer">
  <meta name="twitter:title" content="My first reinforcement learning model on AWS">
  <meta name="twitter:description" content="This article demonstrates my experience of training a reinforcement learning (RL) model on AWS.">

  
    <meta property="og:image" content="https://lxyuan0420.github.io/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
    <meta name="twitter:image" content="https://lxyuan0420.github.io/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
  

  <link href="https://lxyuan0420.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Lx Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-light-a98c41efc5ed9fcc06ac664c9e2f7a9b3c3b2e0a52357d221fe382f6f4abc8fc.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
      <link rel="stylesheet" type="text/css" href="/assets/light-bb1553a18d0f1ccfe1aabc010584c49b4277a88503216b78906ba719e30019c1.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Lx">Lx</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://twitter.com/lxyuan" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/LxYuan0420" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/likxunyuan" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:lxyuan0420@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>My first reinforcement learning model on AWS</h1>
            <p>This article demonstrates my experience of training a reinforcement learning (RL) model on AWS.</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    May 24, 2023
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      3 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>Recently, I signed up for a free-tier account on AWS to delve deeper into their
various services, and that’s when I stumbled upon AWS DeepRacer—a thrilling car
racing game based on reinforcement learning. I found it interesting
and thought it was definitely worth a try, especially considering that new
users receive 10 free hours to train or evaluate models, along with 5GB of free
storage during the first month. Why not take advantage of this opportunity?</p>

<p>In DeepRacer, we have the opportunity to define our desired behavior and
indicate what is considered favorable or unfavorable to the car by creating a
Python function that returns a floating-point reward. This function serves as a
guiding principle, helping the car distinguish between right and wrong actions.
Additionally, we can configure training scenarios by selecting virtual tracks,
adjusting training durations, and fine-tuning the car’s steering and
acceleration sensitivity. During training, progress is constantly monitored,
measuring the percentage of the track completed before veering off-course. To
further assess the car’s performance, we can evaluate and monitor its behavior
through virtual evaluation videos after each training session.</p>

<p>Below is the python-based reward function I used:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">math</span>
<span class="k">def</span> <span class="nf">reward_function</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>

    <span class="c1"># Reward weights
</span>    <span class="n">speed_weight</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">heading_weight</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">steering_weight</span> <span class="o">=</span> <span class="mi">50</span>

    <span class="c1"># Initialize the reward based on current speed
</span>    <span class="n">max_speed_reward</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="n">min_speed_reward</span> <span class="o">=</span> <span class="mf">3.33</span> <span class="o">*</span> <span class="mf">3.33</span>
    <span class="n">abs_speed_reward</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">'speed'</span><span class="p">]</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s">'speed'</span><span class="p">]</span>
    <span class="n">speed_reward</span> <span class="o">=</span> <span class="p">(</span><span class="n">abs_speed_reward</span> <span class="o">-</span> <span class="n">min_speed_reward</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_speed_reward</span> <span class="o">-</span> <span class="n">min_speed_reward</span><span class="p">)</span> <span class="o">*</span> <span class="n">speed_weight</span>
    
    <span class="c1"># - - - - - 
</span>    
    <span class="c1"># Penalize if the car goes off track
</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">[</span><span class="s">'all_wheels_on_track'</span><span class="p">]:</span>
        <span class="k">return</span> <span class="mf">1e-3</span>
    
    <span class="c1"># - - - - - 
</span>    
    <span class="c1"># Calculate the direction of the center line based on the closest waypoints
</span>    <span class="n">next_point</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">'waypoints'</span><span class="p">][</span><span class="n">params</span><span class="p">[</span><span class="s">'closest_waypoints'</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">prev_point</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">'waypoints'</span><span class="p">][</span><span class="n">params</span><span class="p">[</span><span class="s">'closest_waypoints'</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

    <span class="c1"># Calculate the direction in radius, arctan2(dy, dx), the result is (-pi, pi) in radians
</span>    <span class="n">track_direction</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">next_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">next_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
    <span class="c1"># Convert to degree
</span>    <span class="n">track_direction</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">track_direction</span><span class="p">)</span>

    <span class="c1"># Calculate the difference between the track direction and the heading direction of the car
</span>    <span class="n">direction_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">track_direction</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s">'heading'</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">direction_diff</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="n">direction_diff</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">direction_diff</span>
    
    <span class="n">abs_heading_reward</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">direction_diff</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="n">heading_reward</span> <span class="o">=</span> <span class="n">abs_heading_reward</span> <span class="o">*</span> <span class="n">heading_weight</span>
    
    <span class="c1"># - - - - -
</span>    
    <span class="c1"># Reward if steering angle is aligned with direction difference
</span>    <span class="n">abs_steering_reward</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s">'steering_angle'</span><span class="p">]</span> <span class="o">-</span> <span class="n">direction_diff</span><span class="p">)</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">)</span>
    <span class="n">steering_reward</span> <span class="o">=</span> <span class="n">abs_steering_reward</span> <span class="o">*</span> <span class="n">steering_weight</span>

    <span class="c1"># - - - - -
</span>    
    <span class="k">return</span> <span class="n">speed_reward</span> <span class="o">+</span> <span class="n">heading_reward</span> <span class="o">+</span> <span class="n">steering_reward</span></code></pre></figure>

<p>You can see how the car performs during the evaluation phase:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/dQ2NinHaC5c" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen=""></iframe>

<p>or click this <a href="https://www.youtube.com/watch?v=dQ2NinHaC5c">youtube link</a></p>

<p>Related:</p>
<ul>
  <li><a href="https://medium.com/axel-springer-tech/how-to-win-aws-deepracer-ce15454f594a">How to win AWS DeepRacer</a></li>
  <li><a href="https://docs.aws.amazon.com/deepracer/latest/developerguide/deepracer-reward-function-input.html?utm_source=Udacity&amp;utm_medium=Webpage&amp;utm_campaign=Udacity%20AWS%20ML%20Foundations%20Course#reward-function-input-objects_speed">DeepRacer docs</a></li>
</ul>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=My+first+reinforcement+learning+model+on+AWS%20-%20https://lxyuan0420.github.io/posts/aws-rl-deepracer%20by%20@lxyuan" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://lxyuan0420.github.io/posts/aws-rl-deepracer" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
        </article>
        <footer class="footer scrollappear">
  <p>
    Made with <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Download Chalk">Chalk</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  

<script src="/assets/vendor-3ee2c63bbac916f96cd7f90e83ab767f058ead1301444c9966f5156911c8be7f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


</body>
</html>
