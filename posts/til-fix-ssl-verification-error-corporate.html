<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lx | TIL: How to Handle SSL Verification Errors in Corporate Environments</title>
  <meta name="description" content="Handling SSL Verification Errors with Custom Certificates in Corporate Environments - ZScaler">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="TIL: How to Handle SSL Verification Errors in Corporate Environments">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://lxyuan0420.github.io/posts/til-fix-ssl-verification-error-corporate">
  <meta property="og:description" content="Handling SSL Verification Errors with Custom Certificates in Corporate Environments - ZScaler">
  <meta property="og:site_name" content="Lx">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="https://lxyuan0420.github.io/posts/til-fix-ssl-verification-error-corporate">
  <meta name="twitter:title" content="TIL: How to Handle SSL Verification Errors in Corporate Environments">
  <meta name="twitter:description" content="Handling SSL Verification Errors with Custom Certificates in Corporate Environments - ZScaler">

  
    <meta property="og:image" content="https://lxyuan0420.github.io/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
    <meta name="twitter:image" content="https://lxyuan0420.github.io/assets/og-image-ee46bbc61b334e821e81534b1fd43f3fee6f020ec174b3c2114445695fd48c01.jpg">
  

  <link href="https://lxyuan0420.github.io/feed.xml" type="application/rss+xml" rel="alternate" title="Lx Last 10 blog posts" />

  

  

    
      <link rel="icon" type="image/x-icon" href="/assets/favicon-light-a98c41efc5ed9fcc06ac664c9e2f7a9b3c3b2e0a52357d221fe382f6f4abc8fc.ico">
      <link rel="apple-touch-icon" href="/assets/apple-touch-icon-light-87d1f2a3a19b1500e5c1626a0492025ca5f7f97d24540dc5900288e92112925a.png">
      <link rel="stylesheet" type="text/css" href="/assets/light-bb1553a18d0f1ccfe1aabc010584c49b4277a88503216b78906ba719e30019c1.css">
    

  

</head>

<body>
  <main>
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav scrollappear">
  <a href="/" class="header-logo" title="Lx">Lx</a>
  <ul class="header-links">
    
    
      <li>
        <a href="https://twitter.com/lxyuan" rel="noreferrer noopener" target="_blank" title="Twitter">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-twitter">
  <use href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter" xlink:href="/assets/twitter-8842c33965263ad1b03a978406826677a668f94125d5837e70ab83f24b3213a7.svg#icon-twitter"></use>
</svg>

        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://github.com/LxYuan0420" rel="noreferrer noopener" target="_blank" title="GitHub">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-github">
  <use href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github" xlink:href="/assets/github-094f81040819f34343ee6ffff0980f17e2807b08b595eaaf66ae3554934fd78d.svg#icon-github"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/likxunyuan" rel="noreferrer noopener" target="_blank" title="LinkedIn">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-linkedin">
  <use href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin" xlink:href="/assets/linkedin-cdc5c107044324a3dfbea2e9ead15873f8dee304c37d73a046988956b706256e.svg#icon-linkedin"></use>
</svg>

        </a>
      </li>
    
    
    
    
    
    
    
    
    
    
    
    
    
      <li>
        <a href="mailto:lxyuan0420@gmail.com" title="Email">
          <svg xmlns="http://www.w3.org/2000/svg" class="icon-email">
  <use href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email" xlink:href="/assets/email-782473193bf750036fdb90e8daa075508a20509d01854c09f3237c144a3f0601.svg#icon-email"></use>
</svg>

        </a>
      </li>
    
    
    
  </ul>
</nav>



        <article class="article scrollappear">
          <header class="article-header">
            <h1>TIL: How to Handle SSL Verification Errors in Corporate Environments</h1>
            <p>Handling SSL Verification Errors with Custom Certificates in Corporate Environments - ZScaler</p>
            <div class="article-list-footer">
  <span class="article-list-date">
    November 13, 2024
  </span>
  <span class="article-list-divider">-</span>
  <span class="article-list-minutes">
    
    
      2 minute read
    
  </span>
  <span class="article-list-divider">-</span>
  <div class="article-list-tags">
    
  </div>
</div>
          </header>

          <div class="article-content">
            <p>Today, I ran into a common issue in corporate networks: SSL verification errors when trying to use certain tools. In many corporate environments, network security solutions (like Zscaler, Palo Alto, etc.) intercept HTTPS connections for inspection. This can lead to SSL verification errors when working with tools like Python’s requests, curl, and the Hugging Face CLI, which expect standard SSL certificates.</p>

<p>If you have seen errors such as <code class="highlighter-rouge">Caused by SSLError(SSLError(1, '[SSL] record layer failure (_ssl.c:1020)]</code> or <code class="highlighter-rouge">Caused by SSLError(SSLError(1, '[SSL: WRONG_VERSION_NUMBER] wrong version number (_ssl.c:1000)'))</code>, this guide provides a simple solution to enable these tools to function with custom SSL certificates.</p>

<h5 id="why-does-this-happen">Why Does This Happen?</h5>

<p>Corporate security solutions often insert their own certificates to inspect encrypted traffic. As a result, when tools like <code class="highlighter-rouge">requests</code> or <code class="highlighter-rouge">curl</code> try to verify SSL certificates, they encounter an unfamiliar certificate that isn’t in their trusted CA bundle, resulting in SSL errors.</p>

<p>To solve this, you’ll need to add the network’s root certificate to the CA bundle used by these tools.</p>

<h5 id="step-by-step-guide-to-setting-up-custom-certificates">Step-by-Step Guide to Setting Up Custom Certificates</h5>

<p>Here’s how to configure custom certificates so that <code class="highlighter-rouge">requests</code>, <code class="highlighter-rouge">curl</code>, and other tools can connect to secure sites without issues. This approach ensures your tools recognize the certificate as trusted and prevents SSL verification errors.</p>

<p>First, obtain the custom root certificate from your IT department. It’s often a <code class="highlighter-rouge">.pem</code> file, typically named something like CompanyRootCertificate.pem. This certificate is needed to add to your system’s CA bundle.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># 1. Download Zscaler Root Certificate</span>
<span class="c"># Make sure you have `ZscalerRootCertificate-2048-SHA256.pem` downloaded</span>

<span class="c"># 2. Install `certifi` with Homebrew</span>
brew <span class="nb">install </span>certifi

<span class="c"># 3. Add Zscaler Certificate to `certifi` Bundle</span>
<span class="c"># Find the path to certifi's CA bundle and append Zscaler's certificate</span>
<span class="nb">cat </span>ZscalerRootCertificate-2048-SHA256.pem <span class="o">&gt;&gt;</span> <span class="si">$(</span>python3 <span class="nt">-m</span> certifi<span class="si">)</span>

<span class="c"># 4. Set Environment Variable for Python's `requests`</span>
<span class="c"># Add this line to your ~/.zshrc or ~/.bashrc</span>
<span class="nb">echo</span> <span class="s1">'export REQUESTS_CA_BUNDLE=$(python3 -m certifi)'</span> <span class="o">&gt;&gt;</span> ~/.zshrc
<span class="c"># Reload shell configuration</span>
<span class="nb">source</span> ~/.zshrc  <span class="c"># or `source ~/.bashrc` for Bash users</span>

<span class="c"># 5. Test Configuration</span>

<span class="c"># Python's requests</span>
python3 <span class="nt">-c</span> <span class="s2">"import requests; print(requests.get('https://httpbin.org/get').status_code)"</span>

<span class="c"># curl</span>
curl https://httpbin.org/get

<span class="c"># Hugging Face CLI</span>
huggingface-cli download google-bert/bert-base-uncased</code></pre></figure>

<p>Hopefully, this helps anyone else who runs into similar issues!</p>

          </div>
          <div class="article-share">
            
            
            <a href="https://twitter.com/home?status=TIL:+How+to+Handle+SSL+Verification+Errors+in+Corporate+Environments%20-%20https://lxyuan0420.github.io/posts/til-fix-ssl-verification-error-corporate%20by%20@lxyuan" title="Share on Twitter" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M492 109.5c-17.4 7.7-36 12.9-55.6 15.3 20-12 35.4-31 42.6-53.6 -18.7 11.1-39.4 19.2-61.5 23.5C399.8 75.8 374.6 64 346.8 64c-53.5 0-96.8 43.4-96.8 96.9 0 7.6 0.8 15 2.5 22.1 -80.5-4-151.9-42.6-199.6-101.3 -8.3 14.3-13.1 31-13.1 48.7 0 33.6 17.2 63.3 43.2 80.7C67 210.7 52 206.3 39 199c0 0.4 0 0.8 0 1.2 0 47 33.4 86.1 77.7 95 -8.1 2.2-16.7 3.4-25.5 3.4 -6.2 0-12.3-0.6-18.2-1.8 12.3 38.5 48.1 66.5 90.5 67.3 -33.1 26-74.9 41.5-120.3 41.5 -7.8 0-15.5-0.5-23.1-1.4C62.8 432 113.7 448 168.3 448 346.6 448 444 300.3 444 172.2c0-4.2-0.1-8.4-0.3-12.5C462.6 146 479 129 492 109.5z"/></svg>
            </a>
            <a href="https://www.facebook.com/sharer/sharer.php?u=https://lxyuan0420.github.io/posts/til-fix-ssl-verification-error-corporate" title="Share on Facebook" rel="noreferrer noopener" target="_blank">
              <svg viewBox="0 0 512 512"><path d="M288 192v-38.1c0-17.2 3.8-25.9 30.5-25.9H352V64h-55.9c-68.5 0-91.1 31.4-91.1 85.3V192h-45v64h45v192h83V256h56.4l7.6-64H288z"/></svg>
            </a>
          </div>

          
        </article>
        <footer class="footer scrollappear">
  <p>
    Made with <a href="https://github.com/nielsenramon/chalk" rel="noreferrer noopener" target="_blank" title="Download Chalk">Chalk</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  

<script src="/assets/vendor-3ee2c63bbac916f96cd7f90e83ab767f058ead1301444c9966f5156911c8be7f.js" type="text/javascript"></script>


  <script src="/assets/webfonts-96493456d319d1bf419afdf8701552d4d486fee6afd304897d4fd81eb4e0cc0b.js" type="text/javascript"></script>



  <script src="/assets/scrollappear-e2da8ea567e418637e31266cc5302126eaa79f62a2273739086358b589a89ee6.js" type="text/javascript"></script>


<script src="/assets/application-cfde13ac81ddaf4351b2e739603e2baf688d0fcc9aba613fe62bbb1c7b037fb9.js" type="text/javascript"></script>


</body>
</html>
